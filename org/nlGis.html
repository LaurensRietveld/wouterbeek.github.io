<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-12-25 Mon 20:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>nlGis</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Wouter Beek" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">nlGis</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5951a92">1. Installing the ETL</a>
<ul>
<li><a href="#org5e9f17b">1.1. Install GDAL</a></li>
<li><a href="#orga524df7">1.2. Install GraphViz</a></li>
<li><a href="#org957bf29">1.3. Install SWI-Prolog</a></li>
<li><a href="#org51c1e31">1.4. Install Prolog libraries</a></li>
<li><a href="#orgc6ca929">1.5. Add a Triply configuration file</a></li>
<li><a href="#orgd912196">1.6. Running an ETL script</a></li>
</ul>
</li>
<li><a href="#org91a356e">2. Generic ETL process</a></li>
<li><a href="#org91dd16c">3. <i>CShapes</i> ETL</a>
<ul>
<li><a href="#orge9e9d28">3.1. Downloading the latest version</a></li>
<li><a href="#orgdba6f03">3.2. Transform the source data to RDF</a>
<ul>
<li><a href="#orgda2e7b0">3.2.1. ZIP → ShapeFile</a></li>
<li><a href="#org16363c9">3.2.2. ShapeFile → GML</a></li>
<li><a href="#org16c476d">3.2.3. GML → RDF</a></li>
</ul>
</li>
<li><a href="#orgcf7175e">3.3. Generating the schema overview</a></li>
<li><a href="#org66b9646">3.4. Uploading the dataset</a></li>
</ul>
</li>
<li><a href="#orgef18b62">4. <i>Mint Authorities of the Low Countries</i> ETL</a>
<ul>
<li><a href="#orgf7b5abb">4.1. Downloading the latest version</a></li>
<li><a href="#org4046f83">4.2. GeoJSON → RDF</a>
<ul>
<li><a href="#org121dded">4.2.1. Authority</a></li>
<li><a href="#orga035a05">4.2.2. Date cleanup</a></li>
</ul>
</li>
<li><a href="#org3720189">4.3. Generating the schema overview</a></li>
<li><a href="#org2cdaa47">4.4. Uploading the dataset</a></li>
</ul>
</li>
<li><a href="#org755f690">5. Gemeentegeschiedenis ETL</a></li>
<li><a href="#orge7d9df0">6. <i>nlGis</i>: combining multiple datasets</a></li>
</ul>
</div>
</div>
<p>
This repository documents and provides the reusable source for
generating Linked Data versions of several key datasets about historic
geographic information.  This work is funded by the <a href="https://iisg.amsterdam">International
Institute for Social History (IISH)</a> and performed by <a href="https://triply.cc">Triply</a>, in a
close collaboration between Wouter Beek (Triply) and Richard Zijdeman
(IISH).
</p>

<p>
Note: this documentation contains a few conversion mistakes (e.g., the
SVG versions of the UML-like diagrams) on Githib.  The correct HTML
version can be read <a href="https://wouterbeek.github.io/org/nlGis.html">here</a>.
</p>

<p>
The datasets can be visited online:
</p>
<ul class="org-ul">
<li><a href="https://druid.datalegend.net/dataLegend/cshapes">CShapes</a></li>
<li><a href="https://druid.datalegend.net/dataLegend/mint">Mint Authorities of the Low Countries</a></li>
<li><a href="https://druid.datalegend.net/dataLegend/gemeentegeschiedenis">Gemeentegeschiedenis</a></li>
<li><a href="https://druid.datalegend.net/dataLegend/nlGis">nlGis</a></li>
</ul>

<div id="outline-container-org5951a92" class="outline-2">
<h2 id="org5951a92"><span class="section-number-2">1</span> Installing the ETL</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org5e9f17b" class="outline-3">
<h3 id="org5e9f17b"><span class="section-number-3">1.1</span> Install GDAL</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-sh">$ sudo apt install gdal-bin <span style="color: #b22222;"># </span><span style="color: #b22222;">Ubuntu</span>
$ sudo dnf install gdal     <span style="color: #b22222;"># </span><span style="color: #b22222;">Fedora</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga524df7" class="outline-3">
<h3 id="orga524df7"><span class="section-number-3">1.2</span> Install GraphViz</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-sh">$ sudo apt install graphviz <span style="color: #b22222;"># </span><span style="color: #b22222;">Ubuntu</span>
$ sudo dnf install graphviz <span style="color: #b22222;"># </span><span style="color: #b22222;">Fedora</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org957bf29" class="outline-3">
<h3 id="org957bf29"><span class="section-number-3">1.3</span> Install SWI-Prolog</h3>
<div class="outline-text-3" id="text-1-3">
<p>
The following works on Ubuntu:
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-add-repository ppa:swi-prolog/stable
sudo apt-get update
sudo apt-get install swi-prolog
</pre>
</div>

<p>
For Fedora or other distros, see <a href="http://www.swi-prolog.org/build/unix.html">the online documentation</a>.
</p>
</div>
</div>

<div id="outline-container-org51c1e31" class="outline-3">
<h3 id="org51c1e31"><span class="section-number-3">1.4</span> Install Prolog libraries</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-sh">$ cd ~/lib/swipl/pack
$ git clone https://github.com/wouterbeek/Prolog-Library-Collection
$ git clone https://github.com/wouterbeek/plRdf
$ git clone https://github.com/wouterbeek/tapir
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6ca929" class="outline-3">
<h3 id="orgc6ca929"><span class="section-number-3">1.5</span> Add a Triply configuration file</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Add configuration file (e.g., <code>druid.datalegend.net</code>) with the
following contents:
</p>

<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #a020f0;">"host"</span>: <span style="color: #8b2252;">"api.druid.datalegend.net"</span>,
  <span style="color: #a020f0;">"token"</span>: <span style="color: #8b2252;">"TRIPLY-TOKEN-FROM-DRUID"</span>,
  <span style="color: #a020f0;">"user"</span>: <span style="color: #8b2252;">"dataLegend"</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd912196" class="outline-3">
<h3 id="orgd912196"><span class="section-number-3">1.6</span> Running an ETL script</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Once everything is installed, each of the ETL scripts (<code>run.pl</code>) can
be run in the following way:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cd cshapes <span style="color: #b22222;"># </span><span style="color: #b22222;">Go into the directory containing the script.</span>
$ swipl -g <span style="color: #8b2252;">'run.'</span> run.pl --conf=~/druid.datalegend.net
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org91a356e" class="outline-2">
<h2 id="org91a356e"><span class="section-number-2">2</span> Generic ETL process</h2>
<div class="outline-text-2" id="text-2">
<p>
The ETL process is automated to the extent possible.  This includes
the following generic steps:
</p>

<ol class="org-ol">
<li>Downloading the source data, if accessible online.</li>

<li>Unarchiving the source data, if needed.</li>

<li>Converting the source data from its original format to RDF.</li>

<li>Generating a UML-like overview of the dataset's schema, based on
a SHACL specification file.</li>

<li>Upload the dataset to Druid.</li>
</ol>
</div>
</div>

<div id="outline-container-org91dd16c" class="outline-2">
<h2 id="org91dd16c"><span class="section-number-2">3</span> <i>CShapes</i> ETL</h2>
<div class="outline-text-2" id="text-3">
<p>
The script <code>cshapes/run.pl</code> creates the Linked Data version of the
latest version of Nils Weidmann's <i>CShapes</i> dataset
(<a href="http://nils.weidmann.ws/projects/cshapes.html">http://nils.weidmann.ws/projects/cshapes.html</a>).  At the moment of
writing, the latest version is 0.6 (2016-11-30).  <i>CShapes</i> contains
detailed polygons of the historical maps of the countries of the
world, from 1920 until the present day.  Each country record contains
the codes assigned to it by the Correlates of War and the Gleditsch &amp;
Ward state lists.  We thank Nils Weidmann for publishing this dataset
to the community.
</p>
</div>

<div id="outline-container-orge9e9d28" class="outline-3">
<h3 id="orge9e9d28"><span class="section-number-3">3.1</span> Downloading the latest version</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Different versions of <i>CShapes</i> are published online
(<a href="http://downloads.weidmann.ws/cshapes/Shapefiles/">http://downloads.weidmann.ws/cshapes/Shapefiles/</a>).  Even though the
versions are not described by metadata, the HTML of the page is very
structured, which allows us to extract the latest version
automatically through <a href="https://www.w3.org/TR/xpath-30/">XPath</a>.
</p>

<p>
For example, we can extract the latest version based on the following
HTML elements that appear in the web page:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"cshapes_0.4-2.zip"</span>&gt;cshapes_0.4-2.zip&lt;/<span style="color: #0000ff;">a</span>&gt;
&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"cshapes_0.5-1.zip"</span>&gt;cshapes_0.5-1.zip&lt;/<span style="color: #0000ff;">a</span>&gt;
</pre>
</div>

<p>
In order to do so we first download the web page into a <code>DOM</code>
representation (Document Object Model).  We then try to find all the
pairs <code>Version-RelUri</code> such that <code>Version</code> denotes a version
identifying term of the form <code>version(Major,Minor,Patch)</code>, and
<code>RelUri</code> is the relative URI from which we can download that version.
If we sort those results in descending order (order of terms <code>@&gt;</code>), we
can match the latest version as the first item in the ordered sequence
<code>Sorted</code>.  Since we cannot download from a relative URI (<code>RelUri</code>), we
use the original download URI (<code>BaseUri</code>) to retrieve the absolute URI
from which we can obtain the latest version of <i>CShapes</i> (<code>Uri</code>).  We
end this part with an input stream <code>In</code> from which we can access the
source data stream.
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #a0522d;">BaseUri</span> = <span style="color: #8b2252;">'http://downloads.weidmann.ws/cshapes/Shapefiles/'</span>,
<span style="color: #0000ff;">load_html</span>(<span style="color: #a0522d;">BaseUri</span>, <span style="color: #a0522d;">Dom</span>, <span style="color: #a020f0;">[]</span>),
<span style="color: #0000ff;">findall</span>(
  <span style="color: #a0522d;">Version</span>-<span style="color: #a0522d;">RelUri</span>,
  (
    xpath(<span style="color: #a0522d;">Dom</span>, //a(@href), <span style="color: #a0522d;">RelUri</span>),
    uri_components(<span style="color: #a0522d;">RelUri</span>, <span style="color: #a0522d;">UriComps</span>),
    uri_data(path, <span style="color: #a0522d;">UriComps</span>, <span style="color: #a0522d;">Path</span>),
    atom_codes(<span style="color: #a0522d;">Path</span>, <span style="color: #a0522d;">Codes</span>),
    phrase(cshapes_version(<span style="color: #a0522d;">Version</span>), <span style="color: #a0522d;">Codes</span>)
  ),
  <span style="color: #a0522d;">Pairs</span>
),
<span style="color: #0000ff;">sort</span>(1, @&gt;, <span style="color: #a0522d;">Pairs</span>, <span style="color: #a0522d;">Sorted</span>),
<span style="color: #a0522d;">Sorted</span> = <span style="color: #a020f0;">[</span><span style="color: #a0522d;">Version</span>-<span style="color: #a0522d;">RelUri</span><span style="color: #a020f0;">|</span><span style="color: #a0522d;">_</span><span style="color: #a020f0;">]</span>,
<span style="color: #0000ff;">uri_resolve</span>(<span style="color: #a0522d;">RelUri</span>, <span style="color: #a0522d;">BaseUri</span>, <span style="color: #a0522d;">Uri</span>),
<span style="color: #0000ff;">http_open2</span>(<span style="color: #a0522d;">Uri</span>, <span style="color: #a0522d;">In</span>),
</pre>
</div>

<p>
This process looks a little convoluted: is it not faster to manually
download this dataset through a web browser?  However, notice that the
approach outlined above can be used to extract any number of download
links from any number of weakly structured HTML pages.
</p>
</div>
</div>

<div id="outline-container-orgdba6f03" class="outline-3">
<h3 id="orgdba6f03"><span class="section-number-3">3.2</span> Transform the source data to RDF</h3>
<div class="outline-text-3" id="text-3-2">
<p>
From the last step we have an input stream <code>In</code> from which we can now
read the source data.
</p>
</div>

<div id="outline-container-orgda2e7b0" class="outline-4">
<h4 id="orgda2e7b0"><span class="section-number-4">3.2.1</span> ZIP → ShapeFile</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
The source data is compressed using ZIP.  We first unarchive this ZIP,
which extracts various ShapeFile files.
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">archive_extract</span>(<span style="color: #a0522d;">In1</span>, ., <span style="color: #a020f0;">[]</span>),
</pre>
</div>

<p>
At the end of this step we have the following ShapeFile files locally:
<code>.dbf</code>, <code>.prj</code>, <code>.shp</code>, <code>.shx</code>, and <code>.txt</code>.
</p>
</div>
</div>

<div id="outline-container-org16363c9" class="outline-4">
<h4 id="org16363c9"><span class="section-number-4">3.2.2</span> ShapeFile → GML</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
While it may be possible to convert a ShapeFile into RDF directly, it
is difficult to find online resources that explain how the ShapeFile
format works, which may be due to it being proprietary.  We therefore
convert ShapeFile to Geography Markup Language (GML), which is an
XML-based open format from which we can easily convert to RDF.
</p>

<p>
For this we use the external program <code>ogr2ogr</code> from the Geospatial
Data Abstraction Library (GDAL).  Calling an external program is not
as easy as some programmers seem to think.  In practice we often see
programmers call an external program without relaying the error and
output streams, which means that warnings and errors get lost and
potential mistakes are not detected.  This is why we explicitly copy
the error stream (from <code>ProcErr</code> to <code>user_error</code>) and the output
stream (from <code>ProcOut</code> to <code>user_output</code>) using two detached threads.
We also check whether the status of the external process signals an
error (<code>Status</code>), retrieved through the process identifier (<code>Pid</code>).
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">process_create</span>(
  path(ogr2ogr),
  <span style="color: #a020f0;">[</span><span style="color: #8b2252;">'-f'</span>,<span style="color: #8b2252;">'GML'</span>,file(<span style="color: #8b2252;">'data.gml'</span>),file(<span style="color: #8b2252;">'cshapes.shp'</span>)<span style="color: #a020f0;">]</span>,
  <span style="color: #a020f0;">[</span>process(<span style="color: #a0522d;">Pid</span>),stderr(pipe(<span style="color: #a0522d;">ProcErr</span>)),stdout(pipe(<span style="color: #a0522d;">ProcOut</span>))<span style="color: #a020f0;">]</span>
),
<span style="color: #0000ff;">thread_create</span>(copy_stream_data(<span style="color: #a0522d;">ProcErr</span>, user_error), <span style="color: #a0522d;">_</span>, <span style="color: #a020f0;">[</span>detached(true)<span style="color: #a020f0;">]</span>),
<span style="color: #0000ff;">thread_create</span>(copy_stream_data(<span style="color: #a0522d;">ProcOut</span>, user_output), <span style="color: #a0522d;">_</span>, <span style="color: #a020f0;">[</span>detached(true)<span style="color: #a020f0;">]</span>),
<span style="color: #0000ff;">process_wait</span>(<span style="color: #a0522d;">Pid</span>, exit(<span style="color: #a0522d;">Status</span>)),
(<span style="color: #a0522d;">Status</span> =:= 0 <span style="color: #a020f0;">-&gt;</span> true <span style="color: #a020f0;">;</span> print_message(warning, process_status(<span style="color: #a0522d;">Status</span>))),
</pre>
</div>

<p>
At the end of this step we have the local file <code>data.gml</code>.
</p>
</div>
</div>

<div id="outline-container-org16c476d" class="outline-4">
<h4 id="org16c476d"><span class="section-number-4">3.2.3</span> GML → RDF</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
For this step we are going to stream through the GML file (<code>data.gml</code>)
from the previous step.  While streaming through this GML file, we
assert RDF triples to the internal SWI-Prolog RDF store.  Once the GML
file is completely transformed, we export the content of the internal
RDF store to a GNU zipped N-Quads file (<code>data.nq.gz</code>).
</p>

<p>
We are going to process the GML file one record at a time.  We specify
the name of the XML record: <code>ogr:cshapes</code>.  Each individual record is
then processed by <code>cshapes_record/1</code> (documented below).  Notice that
a similar approach work for converting any XML file to RDF: there is
no need to load the entire XML file into memory.
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">setup_call_cleanup</span>(
  open(<span style="color: #8b2252;">'data.gml'</span>, read, <span style="color: #a0522d;">In2</span>),
  call_on_xml(<span style="color: #a0522d;">In2</span>, <span style="color: #a020f0;">[</span><span style="color: #8b2252;">'ogr:cshapes'</span><span style="color: #a020f0;">]</span>, cshapes_record),
  close(<span style="color: #a0522d;">In2</span>)
),
<span style="color: #0000ff;">setup_call_cleanup</span>(
  gzopen(<span style="color: #8b2252;">'data.nq.gz'</span>, write, <span style="color: #a0522d;">Out</span>),
  rdf_save2(<span style="color: #a0522d;">Out</span>),
  close(<span style="color: #a0522d;">Out</span>)
),
</pre>
</div>

<p>
<code>cshapes_record/1</code> is called for every individual record in the
<i>CShapes</i> source file.  The record is an XML sub-tree (<code>Dom</code>).  We have
declared namespaces for the dataset's vocabulary (<code>vocab</code>) and for the
dataset's instances (<code>resource</code>).  We also have specified a data graph
<code>G</code>.
</p>
</div>

<ol class="org-ol">
<li><a id="org511d7fc"></a>Country resource<br />
<div class="outline-text-5" id="text-3-2-3-1">
<p>
Let's look at a simple conversion from XML to RDF: from the DOM record
(<code>Dom</code>) we extract the name of the country (<code>CountryName</code>) with an
XPath query that matches XML tag <code>ogr:CNTRY_NAME</code>.  We then create an
IRI of the form <code>resource:country/NAME</code>, and assert the following
quadruple:
</p>

<div class="org-src-container">
<pre class="src src-n-quads">resource:country/NAME a vocab:Country graph:data
</pre>
</div>

<p>
The code is as follows:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">xpath_chk</span>(<span style="color: #a0522d;">Dom</span>, //<span style="color: #8b2252;">'ogr:CNTRY_NAME'</span>(normalize_space), <span style="color: #a0522d;">CountryName</span>),
<span style="color: #0000ff;">rdf_create_iri</span>(resource, <span style="color: #a020f0;">[</span>country,<span style="color: #a0522d;">CountryName</span><span style="color: #a020f0;">]</span>, <span style="color: #a0522d;">Country</span>),
<span style="color: #0000ff;">rdf_assert</span>(<span style="color: #a0522d;">Country</span>, rdf:type, vocab:<span style="color: #8b2252;">'Country'</span>, <span style="color: #a0522d;">G</span>),
</pre>
</div>
</div>
</li>

<li><a id="orgf0c0896"></a>Country label<br />
<div class="outline-text-5" id="text-3-2-3-2">
<p>
Other RDF triples are created in a similar way.  For example, the
country name is also also asserted as an <code>rdfs:label</code>:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">rdf_assert</span>(<span style="color: #a0522d;">Country</span>, rdfs:label, <span style="color: #a0522d;">CountryName</span>@<span style="color: #8b2252;">'en-gb'</span>, <span style="color: #a0522d;">G</span>),
</pre>
</div>
</div>
</li>

<li><a id="org6278320"></a>Correlates of War / Gleditsch &amp; Ward state list dates<br />
<div class="outline-text-5" id="text-3-2-3-3">
<p>
The Correlates of War, as well and the Gleditsch &amp; Ward state list
dates are stored in three separate properties (day, month, year) in
the source data.  We combine there into one RDF triple with an object
term literal with the <code>xsd:date</code> datatype.  The source data uses <code>-1</code>
in case date information is absent.  Here is an example for one date
(the Correlates of War start date):
</p>

<div class="org-src-container">
<pre class="src src-prolog">(   xpath_chk(<span style="color: #a0522d;">Dom</span>, //<span style="color: #8b2252;">'ogr:COWSYEAR'</span>(normalize_space), <span style="color: #a0522d;">Y1</span>),
    <span style="color: #a0522d;">Y1</span> \== <span style="color: #8b2252;">'-1'</span>
<span style="color: #a020f0;">-&gt;</span>  xpath_chk(<span style="color: #a0522d;">Dom</span>, //<span style="color: #8b2252;">'ogr:COWSMONTH'</span>(normalize_space), <span style="color: #a0522d;">M1</span>),
    xpath_chk(<span style="color: #a0522d;">Dom</span>, //<span style="color: #8b2252;">'ogr:COWSDAY'</span>(normalize_space), <span style="color: #a0522d;">D1</span>),
    maplist(atom_number, <span style="color: #a020f0;">[</span><span style="color: #a0522d;">Y1</span>,<span style="color: #a0522d;">M1</span>,<span style="color: #a0522d;">D1</span><span style="color: #a020f0;">]</span>, <span style="color: #a020f0;">[</span><span style="color: #a0522d;">Y2</span>,<span style="color: #a0522d;">M2</span>,<span style="color: #a0522d;">D2</span><span style="color: #a020f0;">]</span>)
<span style="color: #a020f0;">;</span>   true
),
</pre>
</div>
</div>
</li>

<li><a id="orgbeee37e"></a>Country &amp; country-slice<br />
<div class="outline-text-5" id="text-3-2-3-4">
<p>
Since the properties of a country change over time, we introduce the
notion of a time-slice:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">rdf_create_iri</span>(resource, <span style="color: #a020f0;">[</span>country,<span style="color: #a0522d;">CountryName</span>,<span style="color: #a0522d;">Y2</span><span style="color: #a020f0;">]</span>, <span style="color: #a0522d;">CountrySlice</span>),
<span style="color: #0000ff;">rdf_assert</span>(<span style="color: #a0522d;">CountrySlice</span>, rdf:type, vocab:<span style="color: #a0522d;">CountrySlice</span><span style="color: #8b2252;">', G),</span>
<span style="color: #8b2252;">rdf_assert(Country, vocab:hasTemporalSlice, CountrySlice, G),</span>
</pre>
</div>
</div>
</li>

<li><a id="org38184e4"></a>Capital city geolocation<br />
<div class="outline-text-5" id="text-3-2-3-5">
<p>
Another example of combine multiple source properties is the
geolocation of capital cities.  While <i>CShapes</i> stores the longitude
and latitude separately, we combine them into one Well-Known Text
(WKT) literal of type <code>Point</code>.
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">xpath_chk</span>(<span style="color: #a0522d;">Dom</span>, //<span style="color: #8b2252;">'ogr:CAPLONG'</span>(number), <span style="color: #a0522d;">CapitalLong</span>),
<span style="color: #0000ff;">xpath_chk</span>(<span style="color: #a0522d;">Dom</span>, //<span style="color: #8b2252;">'ogr:CAPLAT'</span>(number), <span style="color: #a0522d;">CapitalLat</span>),
<span style="color: #0000ff;">rdf_assert_wkt</span>(<span style="color: #a0522d;">Capital</span>, <span style="color: #8b2252;">'Point'</span>(<span style="color: #a020f0;">[</span><span style="color: #a0522d;">CapitalLong</span>,<span style="color: #a0522d;">CapitalLat</span><span style="color: #a020f0;">]</span>), <span style="color: #a0522d;">G</span>),
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgcf7175e" class="outline-3">
<h3 id="orgcf7175e"><span class="section-number-3">3.3</span> Generating the schema overview</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Besides the data generated in the previous step (<code>data.nq.gz</code>), we
also have hand-crafted metadata (<code>meta.trig.gz</code>) and vocabulary
(<code>vocab.trig.gz</code>) files.  The latter includes a SHACL description of
the schema, which can be exported to GraphViz using a UML-like
representation.  In the representation, boxes denote classes and arcs
between boxes denote properties between instances of those classes.
Properties with literal objects are enumerated within each box,
including the datatype IRI of the object literals.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./cshapes/vocab.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org66b9646" class="outline-3">
<h3 id="org66b9646"><span class="section-number-3">3.4</span> Uploading the dataset</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Once we have converted the source data to RDF (<code>data.nq.gz</code>) and have
exported the schema overview (<code>vocab.svg</code>), we can upload the dataset
to Druid.  The dataset consists of the following components:
</p>

<ul class="org-ul">
<li>Access level <code>public</code> (the default is <code>private</code>).</li>
<li>Avatar image file (<code>avatar.png</code>).</li>
<li>Binary / non-RDF files: the source data documentation by Nils
Weidmann (<code>data.txt</code>), and the UML-like schema export
(<code>vocab.svg</code>).</li>
<li>Dataset description.</li>
<li>List of example resources.</li>
<li>RDF files (<code>data.nq.gz</code>, <code>meta.trig.gz</code>, and <code>vocab.trig.gz</code>).</li>
</ul>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #a0522d;">Properties</span> = <span style="color: #a0522d;">_</span><span style="color: #a020f0;">{</span>
  accessLevel: public,
  avatar: <span style="color: #8b2252;">'avatar.png'</span>,
  binary_files: <span style="color: #a020f0;">[</span><span style="color: #8b2252;">'data.txt'</span>,<span style="color: #8b2252;">'vocab.svg'</span><span style="color: #a020f0;">]</span>,
  description: <span style="color: #8b2252;">"The countries of the world, from 1920 untill today.  This dataset includes state boundaries and capitals and is coded according to the Correlates of War and the Gleditsch and Ward (1999) state lists."</span>,
  exampleResources: <span style="color: #a020f0;">[</span>resource-<span style="color: #8b2252;">'country/Guyana/1966'</span><span style="color: #a020f0;">]</span>,
  files: <span style="color: #a020f0;">[</span><span style="color: #8b2252;">'data.nq.gz'</span>,<span style="color: #8b2252;">'meta.trig.gz'</span>,<span style="color: #8b2252;">'vocab.trig.gz'</span><span style="color: #a020f0;">]</span>,
  prefixes: <span style="color: #a020f0;">[</span>
    bnode,
    capital-<span style="color: #8b2252;">'https://iisg.amsterdam/resource/capital/'</span>,
    country-<span style="color: #8b2252;">'https://iisg.amsterdam/resource/country/'</span>,
    dataset-<span style="color: #8b2252;">'https://iisg.amsterdam/dataset/'</span>,
    graph,
    resource,
    sh,
    vocab
  <span style="color: #a020f0;">]</span>
<span style="color: #a020f0;">}</span>,
<span style="color: #0000ff;">dataset_upload</span>(cshapes, <span style="color: #a0522d;">Properties</span>),
</pre>
</div>


<div class="figure">
<p><img src="./cshapes/screenshot.png" alt="screenshot.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgef18b62" class="outline-2">
<h2 id="orgef18b62"><span class="section-number-2">4</span> <i>Mint Authorities of the Low Countries</i> ETL</h2>
<div class="outline-text-2" id="text-4">
<p>
The <i>Mint Authorities of the Low Countries</i>
(<a href="https://datasets.socialhistory.org/dataset.xhtml?persistentId=hdl:10622/HPIC74">https://datasets.socialhistory.org/dataset.xhtml?persistentId=hdl:10622/HPIC74</a>)
is a dataset containing the polygons of the major coin issuing
authorities that existed in the Low Countries.  Each authority is
paired with beginning and end dates.  Starting from the twelfth
century onward, most authorities are included except for small
authorities such as towns.  We thank Rombert Stapel for publishing
this dataset to the community.
</p>
</div>

<div id="outline-container-orgf7b5abb" class="outline-3">
<h3 id="orgf7b5abb"><span class="section-number-3">4.1</span> Downloading the latest version</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The latest version can be download from the IISH Dataverse instance
(<a href="https://datasets.socialhistory.org/dataset.xhtml?persistentId=hdl:10622/HPIC74">https://datasets.socialhistory.org/dataset.xhtml?persistentId=hdl:10622/HPIC74</a>).
The download cannot be automated because a form has to be filled in
prior to downloading the data.  (The form is there to help the
original data publishers get some feedback about the extent to which
this dataset is reused by the community.)
</p>
</div>
</div>

<div id="outline-container-org4046f83" class="outline-3">
<h3 id="org4046f83"><span class="section-number-3">4.2</span> GeoJSON → RDF</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The script at <code>mint/run.pl</code> assumes the following files are present:
</p>

<ul class="org-ul">
<li><code>mint/authorities.geojson.gz</code></li>
<li><code>mint/houses.geojson.gz</code></li>
</ul>

<p>
The GeoJSON format consists of JSON objects that contains a <code>features</code>
key.  These features are extracted from a GeoJSON file (<code>File</code>) with
the following code:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">file_features</span>(<span style="color: #a0522d;">File</span>, <span style="color: #a0522d;">Features</span>) :-
  setup_call_cleanup(
    gzopen(<span style="color: #a0522d;">File</span>, read, <span style="color: #a0522d;">In</span>),
    json_read_dict(<span style="color: #a0522d;">In</span>, <span style="color: #a0522d;">Dict</span>, <span style="color: #a020f0;">[</span>value_string_as(atom)<span style="color: #a020f0;">]</span>),
    close(<span style="color: #a0522d;">In</span>)
  ),
  <span style="color: #a0522d;">_</span><span style="color: #a020f0;">{</span>features: <span style="color: #a0522d;">Features</span><span style="color: #a020f0;">}</span> :&lt; <span style="color: #a0522d;">Dict</span>.
</pre>
</div>

<p>
<code>file_features/2</code> is then use in the following way to extract all
authority features, and runs <code>authority/2</code> to convert authority
features to RDF:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">file_features</span>(<span style="color: #8b2252;">'authorities.geojson.gz'</span>, <span style="color: #a0522d;">Features</span>),
<span style="color: #0000ff;">maplist</span>(authority(graph:authorities), <span style="color: #a0522d;">Features</span>),
</pre>
</div>
</div>

<div id="outline-container-org121dded" class="outline-4">
<h4 id="org121dded"><span class="section-number-4">4.2.1</span> Authority</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
We extract the geometry for each authority feature set (<code>Features</code>),
and extract the type and coordinates from it.  The type and
coordinates are combined into one Prolog term <code>Shape</code> which is
asserted as Well-Known Text (WKT).
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #a0522d;">_</span><span style="color: #a020f0;">{</span>coordinates: <span style="color: #a0522d;">Coords</span>, type: <span style="color: #a0522d;">Type</span><span style="color: #a020f0;">}</span> :&lt; <span style="color: #a0522d;">Featue</span>.<span style="color: #0000ff;">geometry</span>
<span style="color: #a0522d;">Shape</span> =.. <span style="color: #a020f0;">[</span><span style="color: #a0522d;">Type</span>,<span style="color: #a0522d;">Coords</span><span style="color: #a020f0;">]</span>,
<span style="color: #0000ff;">rdf_assert_wkt</span>(<span style="color: #a0522d;">Authority</span>, <span style="color: #a0522d;">Shape</span>, <span style="color: #a0522d;">G1</span>, <span style="color: #a0522d;">Geometry2</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga035a05" class="outline-4">
<h4 id="orga035a05"><span class="section-number-4">4.2.2</span> Date cleanup</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
In the GeoJSON source files, dates are specified as <code>YYYY/MM/DD</code>.  We
reformat these to be compliant with the XML Schema datatype
<code>xsd:date</code>, using the following rewrite grammar:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">date</span>(date(<span style="color: #a0522d;">Y</span>,<span style="color: #a0522d;">M</span>,<span style="color: #a0522d;">D</span>)) --&gt;
  integer(<span style="color: #a0522d;">Y</span>),
  <span style="color: #8b2252;">"/"</span>,
  integer(<span style="color: #a0522d;">M</span>),
  <span style="color: #8b2252;">"/"</span>,
  integer(<span style="color: #a0522d;">D</span>).
</pre>
</div>

<p>
Some dates actually denote years.  We have asserted these with
datatype IRI <code>xsd:gYear</code>.  See the script for more details.
</p>
</div>
</div>
</div>

<div id="outline-container-org3720189" class="outline-3">
<h3 id="org3720189"><span class="section-number-3">4.3</span> Generating the schema overview</h3>
<div class="outline-text-3" id="text-4-3">
<p>
As with the <i>CShapes</i> dataset, we have specified metadata
(<code>meta.trig.gz</code>) and vocabulary (<code>vocab.trig.gz</code>) files by hand.  The
latter includes a SHACL description of the schema, which can be
exported to GraphViz using the UML-like representation discussed in
the section on <i>CShapes</i>.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="./mint/vocab.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org2cdaa47" class="outline-3">
<h3 id="org2cdaa47"><span class="section-number-3">4.4</span> Uploading the dataset</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Once we have converted the source data to RDF (<code>data.nq.gz</code>) and have
exported the schema overview (<code>vocab.svg</code>), we can upload the dataset
to Druid.  The dataset consists of the following components:
</p>

<ul class="org-ul">
<li>Access level <code>public</code> (the default is <code>private</code>).</li>
<li>Avatar image file (<code>avatar.png</code>).</li>
<li>Binary / non-RDF files: movie created by Rombert Stapel
(<code>mint.mp4</code>), and the UML-like schema export (<code>vocab.svg</code>).</li>
<li>Dataset description.</li>
<li>List of example resources.</li>
<li>RDF files (<code>data.nq.gz</code>, <code>meta.trig.gz</code>, and <code>vocab.trig.gz</code>).</li>
</ul>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #a0522d;">Properties</span> = <span style="color: #a0522d;">_</span><span style="color: #a020f0;">{</span>
  accessLevel: public,
  avatar: <span style="color: #8b2252;">'avatar.jpg'</span>,
  binary_files: <span style="color: #a020f0;">[</span><span style="color: #8b2252;">'mint.mp4'</span>,<span style="color: #8b2252;">'vocab.svg'</span><span style="color: #a020f0;">]</span>,
  description: <span style="color: #8b2252;">"Polygons of the major coin issueing authorities that existed in the Low Countries between the 6th and the 21st centuries.  This dataset also includes points for the mint houses responsible for the production of coins."</span>,
  exampleResources: <span style="color: #a020f0;">[</span>authority-<span style="color: #8b2252;">'Mechelen'</span>,house-<span style="color: #8b2252;">'Maaseik'</span><span style="color: #a020f0;">]</span>,
  files: <span style="color: #a020f0;">[</span><span style="color: #8b2252;">'data.nq.gz'</span>,<span style="color: #8b2252;">'meta.trig.gz'</span>,<span style="color: #8b2252;">'vocab.trig.gz'</span><span style="color: #a020f0;">]</span>,
  prefixes: <span style="color: #a020f0;">[</span>
    bnode,
    authority-<span style="color: #8b2252;">'https://iisg.amsterdam/resource/authority/'</span>,
    dataset-<span style="color: #8b2252;">'https://iisg.amsterdam/dataset/'</span>,
    fabio,
    graph,
    house-<span style="color: #8b2252;">'https://iisg.amsterdam/resource/house/'</span>,
    orcid,
    rel,
    sh,
    vocab
  <span style="color: #a020f0;">]</span>
<span style="color: #a020f0;">}</span>,
<span style="color: #0000ff;">dataset_upload</span>(mint, <span style="color: #a0522d;">Properties</span>),
</pre>
</div>


<div class="figure">
<p><img src="./mint/screenshot.png" alt="screenshot.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org755f690" class="outline-2">
<h2 id="org755f690"><span class="section-number-2">5</span> Gemeentegeschiedenis ETL</h2>
<div class="outline-text-2" id="text-5">
<p>
The script <code>gg/run.pl</code> creates the Linked Data version of the latest
version of the Gemeentegeschiedenis dataset
(<a href="http://www.gemeentegeschiedenis.nl/">http://www.gemeentegeschiedenis.nl/</a>).  This dataset is already
published as RDF, so it does not have to be transformed.  Instead, we
use the standardized RDF downloading approach in which we start with a
limited number of URIs and then traverse the rest of the RDF graph
from thereon.  This download strategy is called <i>dereferencing</i>.
</p>

<p>
We use the 12 web pages for the Dutch provinces as the entry points to
the dataset.  The RDF that is encountered by dereference the provinces
is asserted in the local SWI-Prolog RDF store.  When the data is fully
dereferenced, we store the content of the internal RDF store to GNU
zipped N-Quads (<code>data.nq.gz</code>).
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #0000ff;">maplist</span>(
  scrape_province,
  <span style="color: #a020f0;">[</span>
    <span style="color: #8b2252;">'Groningen'</span>, <span style="color: #8b2252;">'Friesland'</span>, <span style="color: #8b2252;">'Drenthe'</span>, <span style="color: #8b2252;">'Overijssel'</span>, <span style="color: #8b2252;">'Flevoland'</span>,
    <span style="color: #8b2252;">'Gelderland'</span>, <span style="color: #8b2252;">'Utrecht'</span>, <span style="color: #8b2252;">'Noord-Holland'</span>, <span style="color: #8b2252;">'Zuid-Holland'</span>, <span style="color: #8b2252;">'Zeeland'</span>,
    <span style="color: #8b2252;">'Noord-Brabant'</span>, <span style="color: #8b2252;">'Limburg'</span>
  <span style="color: #a020f0;">]</span>
),
<span style="color: #0000ff;">setup_call_cleanup</span>(
  gzopen(<span style="color: #8b2252;">'data.nq.gz'</span>, write, <span style="color: #a0522d;">Out</span>),
  rdf_save2(<span style="color: #a0522d;">Out</span>),
  close(<span style="color: #a0522d;">Out</span>)
),
</pre>
</div>


<div class="figure">
<p><img src="./gg/screenshot.png" alt="screenshot.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orge7d9df0" class="outline-2">
<h2 id="orge7d9df0"><span class="section-number-2">6</span> <i>nlGis</i>: combining multiple datasets</h2>
<div class="outline-text-2" id="text-6">
<p>
The three converted datasets are grouped together into the overall
<i>nlGis</i> dataset.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2017-12-25</p>
<p class="author">Author: Wouter Beek</p>
<p class="date">Created: 2017-12-25 Mon 20:50</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
