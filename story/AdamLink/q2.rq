prefix dc: <http://purl.org/dc/elements/1.1/>
prefix dct: <http://purl.org/dc/terms/>
prefix foaf: <http://xmlns.com/foaf/0.1/>
prefix geo: <http://www.opengis.net/ont/geosparql#>
prefix hg: <http://rdf.histograph.io/>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix sem: <http://semanticweb.cs.vu.nl/2009/11/sem/>
prefix void: <http://rdfs.org/ns/void#>
prefix xsd: <http://www.w3.org/2001/XMLSchema#>
select ?shape ?shapeColor ?shapeLabel {
  {
    bind(bif:st_geomfromtext("Polygon((4.898873550546993 52.370216,4.898871722071358 52.37014519945174,4.898866238448969 52.37007446877623,4.898857105091588 52.37000387777728,4.898844331012886 52.36993349612081,4.898827928819544 52.36986339326615,4.898807914698814 52.369793638397475,4.898784308402539 52.36972430035552,4.898757133227664 52.36965544756962,4.898726415993239 52.36958714799018,4.8986921870139515 52.369519469021675,4.898654480070206 52.36945247745601,4.898613332374792 52.36938623940668,4.898568784536147 52.36932082024354,4.898520880518285 52.3692562845282,4.898469667597404 52.36919269595041,4.898415196315227 52.369130117265115,4.8983575204291245 52.36906861023059,4.898296696859053 52.369008235547426,4.898232785631387 52.3689490527987,4.898165849819662 52.36889112039106,4.898095955482347 52.36883449549722,4.898023171597626 52.36877923399943,4.897947569995343 52.36872539043438,4.897869225286089 52.36867301793933,4.897788214787587 52.36862216819972,4.897704618448373 52.368572891398166,4.897618518768892 52.36852523616486,4.897530000720086 52.36847924952966,4.897439151659522 52.368434976875655,4.897346061245189 52.36839246189433,4.897250821347001 52.36835174654254,4.897153525956136 52.36831287100101,4.897054271092276 52.36827587363476,4.8969531547088385 52.36824079095518,4.896850276596306 52.36820765758406,4.896745738283744 52.368176506219385,4.896639642938601 52.36814736760307,4.896532095264888 52.36812027049066,4.896423201399849 52.36809524162288,4.896313068809212 52.36807230569937,4.896201806181135 52.36805148535417,4.89608952331893 52.368032801133516,4.895976331032716 52.36801627147544,4.8958623410300435 52.36800191269172,4.895747665805664 52.36798973895166,4.895632418530498 52.36797976226818,4.895516712939962 52.36797199248595,4.89540066322171 52.36796643727168,4.895284383902951 52.367963102106536,4.895167989737426 52.36796199028077,4.89505159559215 52.36796310289047,4.894935316334064 52.36796643883646,4.894819266716667 52.36797199482542,4.89470356126677 52.36797976537308,4.8945883141714726 52.36798974280974,4.894473639165481 52.36800191728776,4.8943596494188535 52.3680162767913,4.894246457425332 52.36803280714821,4.894134174891312 52.36805149204399,4.894022912625616 52.36807231303788,4.893912780430127 52.368095249581145,4.893803886991442 52.36812027903724,4.893696339773609 52.368147376704265,4.893590244912071 52.36817651583927,4.89348570710893 52.36820766768465,4.8933828295296244 52.36824080149664,4.893281713701117 52.36827588457547,4.8931824594116975 52.36831288229781,4.893085164612519 52.36835175815082,4.892989925320927 52.368392473768296,4.892896835525705 52.368434988968446,4.8928059870943255 52.368479261793546,4.8927174696822915 52.368525248551435,4.8926313706446605 52.36857290385855,4.892547774949838 52.36862218068475,4.892466765095729 52.36867303039972,4.892388421028325 52.36872540282095,4.8923128200628145 52.368779246263315,4.892240036807277 52.36883450759,4.892170143089073 52.36889113226503,4.892103207883945 52.36894906440697,4.892039297247964 52.36900824684422,4.891978474252334 52.3690686211713,4.891920798921161 52.36913012780657,4.891866328172212 52.36919270605101,4.8918151157607515 52.36925629414808,4.891767212226494 52.369320829344716,4.891722664843728 52.369386247953265,4.891681517574669 52.36945248541426,4.891643811026072 52.36951947636018,4.891609582409165 52.369587154680005,4.891578865502924 52.36965545358432,4.891551690620742 52.36972430567138,4.891528084580512 52.36979364299352,4.891508070678169 52.369863397124234,4.891491668664696 52.3699334992257,4.891478894726633 52.370003880116734,4.891469761470107 52.370074470341024,4.891464277908391 52.37014520023568,4.891462449453007 52.370216,4.891464277908391 52.370286799764315,4.891469761470107 52.370357529658975,4.891478894726633 52.370428119883265,4.891491668664696 52.370498500774296,4.891508070678169 52.37056860287577,4.891528084580512 52.37063835700648,4.891551690620742 52.370707694328615,4.891578865502924 52.37077654641568,4.891609582409165 52.37084484532001,4.891643811026072 52.37091252363982,4.891681517574669 52.370979514585756,4.891722664843728 52.37104575204673,4.891767212226494 52.37111117065528,4.8918151157607515 52.37117570585193,4.891866328172212 52.37123929394899,4.891920798921161 52.37130187219343,4.891978474252334 52.3713633788287,4.892039297247964 52.37142375315579,4.892103207883945 52.37148293559303,4.892170143089073 52.37154086773497,4.892240036807277 52.37159749241,4.8923128200628145 52.37165275373669,4.892388421028325 52.37170659717905,4.892466765095729 52.37175896960028,4.892547774949838 52.37180981931525,4.8926313706446605 52.37185909614145,4.8927174696822915 52.37190675144856,4.8928059870943255 52.37195273820646,4.892896835525705 52.37199701103157,4.892989925320927 52.3720395262317,4.893085164612519 52.372080241849176,4.8931824594116975 52.372119117702205,4.893281713701117 52.37215611542454,4.8933828295296244 52.37219119850337,4.89348570710893 52.37222433231535,4.893590244912071 52.372255484160746,4.893696339773609 52.37228462329574,4.893803886991442 52.37231172096276,4.893912780430127 52.37233675041887,4.894022912625616 52.37235968696212,4.894134174891312 52.37238050795602,4.894246457425332 52.37239919285179,4.8943596494188535 52.3724157232087,4.894473639165481 52.372430082712235,4.8945883141714726 52.37244225719026,4.89470356126677 52.37245223462692,4.894819266716667 52.372460005174595,4.894935316334064 52.37246556116354,4.89505159559215 52.37246889710953,4.895167989737426 52.37247000971923,4.895284383902951 52.37246889789346,4.89540066322171 52.37246556272833,4.895516712939962 52.37246000751405,4.895632418530498 52.37245223773182,4.895747665805664 52.37244226104834,4.8958623410300435 52.37243008730828,4.895976331032716 52.372415728524565,4.89608952331893 52.372399198866496,4.896201806181135 52.372380514645826,4.896313068809212 52.37235969430064,4.896423201399849 52.372336758377116,4.896532095264888 52.372311729509356,4.896639642938601 52.37228463239693,4.896745738283744 52.37225549378062,4.896850276596306 52.37222434241594,4.8969531547088385 52.37219120904482,4.897054271092276 52.37215612636524,4.897153525956136 52.37211912899899,4.897250821347001 52.37208025345747,4.897346061245189 52.37203953810567,4.897439151659522 52.37199702312436,4.897530000720086 52.371952750470335,4.897618518768892 52.37190676383514,4.897704618448373 52.37185910860184,4.897788214787587 52.37180983180028,4.897869225286089 52.371758982060676,4.897947569995343 52.37170660956563,4.898023171597626 52.371652766000565,4.898095955482347 52.37159750450278,4.898165849819662 52.37154087960894,4.898232785631387 52.37148294720131,4.898296696859053 52.37142376445257,4.8983575204291245 52.37136338976942,4.898415196315227 52.37130188273488,4.898469667597404 52.37123930404959,4.898520880518285 52.3711757154718,4.898568784536147 52.37111117975646,4.898613332374792 52.371045760593326,4.898654480070206 52.370979522544005,4.8986921870139515 52.37091253097832,4.898726415993239 52.37084485200982,4.898757133227664 52.37077655243039,4.898784308402539 52.370707699644484,4.898807914698814 52.37063836160252,4.898827928819544 52.37056860673386,4.898844331012886 52.370498503879205,4.898857105091588 52.37042812222272,4.898866238448969 52.37035753122377,4.898871722071358 52.37028680054827,4.898873550546993 52.370216))") as ?shape)
    bind("red" as ?shapeColor)
    bind("circular selection area" as ?shapeLabel)
  } union {
    {
      select ?street ?shape {
        ?street a hg:Street ;
          geo:hasGeometry/geo:asWKT ?shape .
        bind(bif:st_geomfromtext("Polygon((4.898873550546993 52.370216,4.898871722071358 52.37014519945174,4.898866238448969 52.37007446877623,4.898857105091588 52.37000387777728,4.898844331012886 52.36993349612081,4.898827928819544 52.36986339326615,4.898807914698814 52.369793638397475,4.898784308402539 52.36972430035552,4.898757133227664 52.36965544756962,4.898726415993239 52.36958714799018,4.8986921870139515 52.369519469021675,4.898654480070206 52.36945247745601,4.898613332374792 52.36938623940668,4.898568784536147 52.36932082024354,4.898520880518285 52.3692562845282,4.898469667597404 52.36919269595041,4.898415196315227 52.369130117265115,4.8983575204291245 52.36906861023059,4.898296696859053 52.369008235547426,4.898232785631387 52.3689490527987,4.898165849819662 52.36889112039106,4.898095955482347 52.36883449549722,4.898023171597626 52.36877923399943,4.897947569995343 52.36872539043438,4.897869225286089 52.36867301793933,4.897788214787587 52.36862216819972,4.897704618448373 52.368572891398166,4.897618518768892 52.36852523616486,4.897530000720086 52.36847924952966,4.897439151659522 52.368434976875655,4.897346061245189 52.36839246189433,4.897250821347001 52.36835174654254,4.897153525956136 52.36831287100101,4.897054271092276 52.36827587363476,4.8969531547088385 52.36824079095518,4.896850276596306 52.36820765758406,4.896745738283744 52.368176506219385,4.896639642938601 52.36814736760307,4.896532095264888 52.36812027049066,4.896423201399849 52.36809524162288,4.896313068809212 52.36807230569937,4.896201806181135 52.36805148535417,4.89608952331893 52.368032801133516,4.895976331032716 52.36801627147544,4.8958623410300435 52.36800191269172,4.895747665805664 52.36798973895166,4.895632418530498 52.36797976226818,4.895516712939962 52.36797199248595,4.89540066322171 52.36796643727168,4.895284383902951 52.367963102106536,4.895167989737426 52.36796199028077,4.89505159559215 52.36796310289047,4.894935316334064 52.36796643883646,4.894819266716667 52.36797199482542,4.89470356126677 52.36797976537308,4.8945883141714726 52.36798974280974,4.894473639165481 52.36800191728776,4.8943596494188535 52.3680162767913,4.894246457425332 52.36803280714821,4.894134174891312 52.36805149204399,4.894022912625616 52.36807231303788,4.893912780430127 52.368095249581145,4.893803886991442 52.36812027903724,4.893696339773609 52.368147376704265,4.893590244912071 52.36817651583927,4.89348570710893 52.36820766768465,4.8933828295296244 52.36824080149664,4.893281713701117 52.36827588457547,4.8931824594116975 52.36831288229781,4.893085164612519 52.36835175815082,4.892989925320927 52.368392473768296,4.892896835525705 52.368434988968446,4.8928059870943255 52.368479261793546,4.8927174696822915 52.368525248551435,4.8926313706446605 52.36857290385855,4.892547774949838 52.36862218068475,4.892466765095729 52.36867303039972,4.892388421028325 52.36872540282095,4.8923128200628145 52.368779246263315,4.892240036807277 52.36883450759,4.892170143089073 52.36889113226503,4.892103207883945 52.36894906440697,4.892039297247964 52.36900824684422,4.891978474252334 52.3690686211713,4.891920798921161 52.36913012780657,4.891866328172212 52.36919270605101,4.8918151157607515 52.36925629414808,4.891767212226494 52.369320829344716,4.891722664843728 52.369386247953265,4.891681517574669 52.36945248541426,4.891643811026072 52.36951947636018,4.891609582409165 52.369587154680005,4.891578865502924 52.36965545358432,4.891551690620742 52.36972430567138,4.891528084580512 52.36979364299352,4.891508070678169 52.369863397124234,4.891491668664696 52.3699334992257,4.891478894726633 52.370003880116734,4.891469761470107 52.370074470341024,4.891464277908391 52.37014520023568,4.891462449453007 52.370216,4.891464277908391 52.370286799764315,4.891469761470107 52.370357529658975,4.891478894726633 52.370428119883265,4.891491668664696 52.370498500774296,4.891508070678169 52.37056860287577,4.891528084580512 52.37063835700648,4.891551690620742 52.370707694328615,4.891578865502924 52.37077654641568,4.891609582409165 52.37084484532001,4.891643811026072 52.37091252363982,4.891681517574669 52.370979514585756,4.891722664843728 52.37104575204673,4.891767212226494 52.37111117065528,4.8918151157607515 52.37117570585193,4.891866328172212 52.37123929394899,4.891920798921161 52.37130187219343,4.891978474252334 52.3713633788287,4.892039297247964 52.37142375315579,4.892103207883945 52.37148293559303,4.892170143089073 52.37154086773497,4.892240036807277 52.37159749241,4.8923128200628145 52.37165275373669,4.892388421028325 52.37170659717905,4.892466765095729 52.37175896960028,4.892547774949838 52.37180981931525,4.8926313706446605 52.37185909614145,4.8927174696822915 52.37190675144856,4.8928059870943255 52.37195273820646,4.892896835525705 52.37199701103157,4.892989925320927 52.3720395262317,4.893085164612519 52.372080241849176,4.8931824594116975 52.372119117702205,4.893281713701117 52.37215611542454,4.8933828295296244 52.37219119850337,4.89348570710893 52.37222433231535,4.893590244912071 52.372255484160746,4.893696339773609 52.37228462329574,4.893803886991442 52.37231172096276,4.893912780430127 52.37233675041887,4.894022912625616 52.37235968696212,4.894134174891312 52.37238050795602,4.894246457425332 52.37239919285179,4.8943596494188535 52.3724157232087,4.894473639165481 52.372430082712235,4.8945883141714726 52.37244225719026,4.89470356126677 52.37245223462692,4.894819266716667 52.372460005174595,4.894935316334064 52.37246556116354,4.89505159559215 52.37246889710953,4.895167989737426 52.37247000971923,4.895284383902951 52.37246889789346,4.89540066322171 52.37246556272833,4.895516712939962 52.37246000751405,4.895632418530498 52.37245223773182,4.895747665805664 52.37244226104834,4.8958623410300435 52.37243008730828,4.895976331032716 52.372415728524565,4.89608952331893 52.372399198866496,4.896201806181135 52.372380514645826,4.896313068809212 52.37235969430064,4.896423201399849 52.372336758377116,4.896532095264888 52.372311729509356,4.896639642938601 52.37228463239693,4.896745738283744 52.37225549378062,4.896850276596306 52.37222434241594,4.8969531547088385 52.37219120904482,4.897054271092276 52.37215612636524,4.897153525956136 52.37211912899899,4.897250821347001 52.37208025345747,4.897346061245189 52.37203953810567,4.897439151659522 52.37199702312436,4.897530000720086 52.371952750470335,4.897618518768892 52.37190676383514,4.897704618448373 52.37185910860184,4.897788214787587 52.37180983180028,4.897869225286089 52.371758982060676,4.897947569995343 52.37170660956563,4.898023171597626 52.371652766000565,4.898095955482347 52.37159750450278,4.898165849819662 52.37154087960894,4.898232785631387 52.37148294720131,4.898296696859053 52.37142376445257,4.8983575204291245 52.37136338976942,4.898415196315227 52.37130188273488,4.898469667597404 52.37123930404959,4.898520880518285 52.3711757154718,4.898568784536147 52.37111117975646,4.898613332374792 52.371045760593326,4.898654480070206 52.370979522544005,4.8986921870139515 52.37091253097832,4.898726415993239 52.37084485200982,4.898757133227664 52.37077655243039,4.898784308402539 52.370707699644484,4.898807914698814 52.37063836160252,4.898827928819544 52.37056860673386,4.898844331012886 52.370498503879205,4.898857105091588 52.37042812222272,4.898866238448969 52.37035753122377,4.898871722071358 52.37028680054827,4.898873550546993 52.370216))") as ?circle)
      filter(bif:GeometryType(bif:st_geomfromtext(?shape))!='POLYGON' && bif:st_intersects(?circle, bif:st_geomfromtext(?shape)))
      }
    }
    {
      select ?street (sample(?cho) as ?cho) {
        ?street a hg:Street .
        ?cho
          dct:spatial ?street ;
          sem:hasBeginTimeStamp ?begin ;
          sem:hasEndTimeStamp ?end .
          filter(datatype(?begin)=xsd:date && datatype(?end)=xsd:date)
          bind(xsd:gYear(?begin) as ?beginYear)
          bind(xsd:gYear(?end) as ?endYear)
          filter(?beginYear>xsd:gYear("1600") && ?endYear<xsd:gYear("1700"))
      }
      group by ?street
    }
    ?street rdfs:label ?streetName .
    ?cho
      dc:title ?title ;
      foaf:depiction ?img ;
      sem:hasBeginTimeStamp ?begin ;
      sem:hasEndTimeStamp ?end ;
      void:inDataset ?dataset .
    bind(concat('<h3>🖼 <a href="',str(?cho),'">',str(?title),'</a></h3>',
                '<h4>🛣 Straat: <a href="',str(?street),'">',str(?streetName),'</a></h4>',
                '<h4>⏲ Periode: ',str(?begin),'―',str(?end),'</h4>',
                '<img src="',?img,'" width="300">') as ?shapeLabel)
  }
}
