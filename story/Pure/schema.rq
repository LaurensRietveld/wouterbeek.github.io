select ?c ?m ?p (count(?o) as ?n) {
  {
    select ?c (count(?i) as ?m) {
      ?i a ?c
    }
    group by ?c
  }
  ?i a ?c ; ?p ?o
}
group by ?c ?m ?p
order by desc(?m) desc(?n)
